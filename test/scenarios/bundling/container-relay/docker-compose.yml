# Container-relay sample: copilot-core in Docker, copilot-core relay on host.
#
# The relay runs on the host with GITHUB_TOKEN and forwards authenticated
# requests to the Copilot API. No secrets enter the container.
#
# Usage:
#   1. Start the relay:  GITHUB_TOKEN=$(gh auth token) copilot-core relay --port 4000
#   2. Start the container: docker compose up -d
#   3. Run client samples against localhost:3000

services:
  copilot-core:
    build:
      context: ../../../..
      dockerfile: test/scenarios/bundling/container-proxy/Dockerfile
    ports:
      - "3000:3000"
    environment:
      # Point LLM requests at the host relay
      COPILOT_API_URL: "http://host.docker.internal:4000/v1"
      # Dummy token so copilot-core enters the Token auth path
      GITHUB_TOKEN: "not-used"
    extra_hosts:
      - "host.docker.internal:host-gateway"
